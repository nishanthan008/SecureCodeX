rules:

  # =========================================================
  # A01: Broken Access Control
  # =========================================================
  - id: java-missing-auth-annotation
    severity: HIGH
    languages: [java]
    pattern: |
      @RequestMapping(...)
      public $RET $METHOD(...) {
        ...
      }
    message: "Controller method without authentication or authorization annotation."
    metadata:
      cwe: CWE-284
      owasp: A01:2021-Broken Access Control


  # =========================================================
  # A02: Cryptographic Failures
  # =========================================================
  - id: java-weak-hash-md5
    severity: MEDIUM
    languages: [java]
    pattern: MessageDigest.getInstance("MD5")
    message: "MD5 is cryptographically weak."
    metadata:
      cwe: CWE-327
      owasp: A02:2021-Cryptographic Failures

  - id: java-weak-hash-sha1
    severity: MEDIUM
    languages: [java]
    pattern: MessageDigest.getInstance("SHA-1")
    message: "SHA-1 is cryptographically weak."
    metadata:
      cwe: CWE-327
      owasp: A02:2021-Cryptographic Failures

  - id: java-hardcoded-secret
    severity: HIGH
    languages: [java]
    pattern-regex: "(password|secret|token|apiKey)\\s*=\\s*\"[^\"]+\""
    message: "Hardcoded secret detected."
    metadata:
      cwe: CWE-798
      owasp: A02:2021-Cryptographic Failures


  # =========================================================
  # A03: Injection
  # =========================================================
  - id: java-sql-injection
    severity: CRITICAL
    languages: [java]
    mode: taint
    source:
      - request.getParameter(...)
      - request.getHeader(...)
    sink:
      - Statement.execute(...)
      - Statement.executeQuery(...)
    message: "User input reaches SQL query execution."
    metadata:
      cwe: CWE-89
      owasp: A03:2021-Injection

  - id: java-jpa-string-query
    severity: HIGH
    languages: [java]
    pattern: entityManager.createQuery("...")
    message: "Dynamic JPQL query detected. Ensure parameter binding."
    metadata:
      cwe: CWE-89
      owasp: A03:2021-Injection

  - id: java-command-injection
    severity: HIGH
    languages: [java]
    pattern-either:
      - pattern: Runtime.getRuntime().exec(...)
      - pattern: new ProcessBuilder(...)
    message: "Command execution detected. Possible command injection."
    metadata:
      cwe: CWE-78
      owasp: A03:2021-Injection

  - id: java-expression-language-injection
    severity: HIGH
    languages: [java]
    pattern: javax.el.ExpressionFactory.newInstance()
    message: "Expression Language evaluation may lead to injection."
    metadata:
      cwe: CWE-917
      owasp: A03:2021-Injection


  # =========================================================
  # A04: Insecure Design
  # =========================================================
  - id: java-insecure-random
    severity: MEDIUM
    languages: [java]
    pattern: new Random()
    message: "java.util.Random is not cryptographically secure."
    metadata:
      cwe: CWE-338
      owasp: A04:2021-Insecure Design


  # =========================================================
  # A05: Security Misconfiguration
  # =========================================================
  - id: java-debug-enabled
    severity: MEDIUM
    languages: [java]
    pattern: server.error.include-stacktrace=always
    message: "Stack trace exposure enabled in configuration."
    metadata:
      cwe: CWE-209
      owasp: A05:2021-Security Misconfiguration

  - id: java-cors-any-origin
    severity: MEDIUM
    languages: [java]
    pattern: allowedOrigins = "*"
    message: "CORS allows all origins."
    metadata:
      cwe: CWE-942
      owasp: A05:2021-Security Misconfiguration


  # =========================================================
  # A06: Vulnerable and Outdated Components
  # =========================================================
  - id: java-outdated-dependency
    severity: MEDIUM
    languages: [java]
    pattern-regex: "<version>[0-9]+\\.[0-9]+\\.[0-9]+</version>"
    message: "Hardcoded dependency version detected. Verify it is not vulnerable."
    metadata:
      cwe: CWE-1104
      owasp: A06:2021-Vulnerable Components


  # =========================================================
  # A07: Identification & Authentication Failures
  # =========================================================
  - id: java-plaintext-password-compare
    severity: HIGH
    languages: [java]
    pattern: if ($PWD.equals($INPUT))
    message: "Plaintext password comparison detected."
    metadata:
      cwe: CWE-521
      owasp: A07:2021-Identification and Authentication Failures

  - id: java-jwt-no-verify
    severity: HIGH
    languages: [java]
    pattern: Jwts.parser().parse(...)
    message: "JWT parsed without explicit signature verification."
    metadata:
      cwe: CWE-347
      owasp: A07:2021-Identification and Authentication Failures


  # =========================================================
  # A08: Software and Data Integrity Failures
  # =========================================================
  - id: java-unsafe-deserialization
    severity: CRITICAL
    languages: [java]
    pattern: new ObjectInputStream(...)
    message: "Unsafe Java deserialization detected."
    metadata:
      cwe: CWE-502
      owasp: A08:2021-Software and Data Integrity Failures


  # =========================================================
  # A09: Logging and Monitoring Failures
  # =========================================================
  - id: java-empty-catch
    severity: LOW
    languages: [java]
    pattern: |
      try {
        ...
      } catch (Exception e) {
      }
    message: "Empty catch block hides exceptions."
    metadata:
      cwe: CWE-391
      owasp: A09:2021-Logging and Monitoring Failures


  # =========================================================
  # A10: Server-Side Request Forgery (SSRF)
  # =========================================================
  - id: java-ssrf
    severity: HIGH
    languages: [java]
    mode: taint
    source:
      - request.getParameter(...)
      - request.getHeader(...)
    sink:
      - new URL(...)
      - HttpURLConnection.openConnection(...)
    message: "User input used in outbound network request."
    metadata:
      cwe: CWE-918
      owasp: A10:2021-SSRF


  # =========================================================
  # Additional Critical Java Vulnerabilities
  # =========================================================
  - id: java-path-traversal
    severity: HIGH
    languages: [java]
    mode: taint
    source:
      - request.getParameter(...)
    sink:
      - new File(...)
      - Paths.get(...)
    message: "User input used in file path (path traversal)."
    metadata:
      cwe: CWE-22

  - id: java-xss
    severity: HIGH
    languages: [java]
    mode: taint
    source:
      - request.getParameter(...)
    sink:
      - response.getWriter().print(...)
      - response.getOutputStream().write(...)
    message: "Reflected XSS vulnerability detected."
    metadata:
      cwe: CWE-79
