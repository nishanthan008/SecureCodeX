rules:

  # =========================================================
  # A01: Broken Access Control
  # =========================================================
  - id: go-missing-auth-middleware
    severity: HIGH
    languages: [go]
    pattern: |
      http.HandleFunc(..., func($REQ, $RES) {
        ...
      })
    message: "HTTP handler defined without visible authentication or authorization middleware."
    metadata:
      cwe: CWE-284
      owasp: A01:2021-Broken Access Control


  # =========================================================
  # A02: Cryptographic Failures
  # =========================================================
  - id: go-weak-hash-md5
    severity: HIGH
    languages: [go]
    pattern: md5.Sum(...)
    message: "MD5 is cryptographically broken. Use SHA-256 or stronger."
    metadata:
      cwe: CWE-327
      owasp: A02:2021-Cryptographic Failures

  - id: go-weak-hash-sha1
    severity: HIGH
    languages: [go]
    pattern: sha1.Sum(...)
    message: "SHA-1 is cryptographically broken."
    metadata:
      cwe: CWE-327
      owasp: A02:2021-Cryptographic Failures

  - id: go-hardcoded-secret
    severity: CRITICAL
    languages: [go]
    pattern-regex: "(password|secret|token|apiKey)\\s*:=\\s*\"[^\"]+\""
    message: "Hardcoded secret detected."
    metadata:
      cwe: CWE-798
      owasp: A02:2021-Cryptographic Failures


  # =========================================================
  # A03: Injection (SQL, Command, Template)
  # =========================================================
  - id: go-sql-injection
    severity: CRITICAL
    languages: [go]
    mode: taint
    source:
      - r.URL.Query().Get(...)
      - r.FormValue(...)
    sink:
      - db.Query(...)
      - db.Exec(...)
    message: "User input reaches SQL query execution without parameterization."
    metadata:
      cwe: CWE-89
      owasp: A03:2021-Injection

  - id: go-command-injection
    severity: CRITICAL
    languages: [go]
    pattern: exec.Command(...)
    message: "OS command execution detected. Possible command injection."
    metadata:
      cwe: CWE-78
      owasp: A03:2021-Injection

  - id: go-template-injection
    severity: HIGH
    languages: [go]
    pattern: template.New(...).Parse(...)
    message: "Dynamic template parsing detected. Possible SSTI if user input is used."
    metadata:
      cwe: CWE-94
      owasp: A03:2021-Injection


  # =========================================================
  # A04: Insecure Design
  # =========================================================
  - id: go-insecure-random
    severity: HIGH
    languages: [go]
    pattern: rand.Int(...)
    message: "math/rand is not cryptographically secure. Use crypto/rand."
    metadata:
      cwe: CWE-338
      owasp: A04:2021-Insecure Design

  - id: go-unchecked-errors
    severity: LOW
    languages: [go]
    pattern: _
    message: "Error return value ignored. This may hide security failures."
    metadata:
      cwe: CWE-703
      owasp: A04:2021-Insecure Design


  # =========================================================
  # A05: Security Misconfiguration
  # =========================================================
  - id: go-http-no-timeout
    severity: MEDIUM
    languages: [go]
    pattern: http.Client{}
    message: "HTTP client without timeout configured."
    metadata:
      cwe: CWE-400
      owasp: A05:2021-Security Misconfiguration

  - id: go-insecure-tls-config
    severity: CRITICAL
    languages: [go]
    pattern: "InsecureSkipVerify: true"
    message: "TLS certificate verification disabled."
    metadata:
      cwe: CWE-295
      owasp: A05:2021-Security Misconfiguration


  # =========================================================
  # A06: Vulnerable and Outdated Components
  # =========================================================
  - id: go-replace-directive
    severity: MEDIUM
    languages: [go]
    pattern: replace
    message: "Go module replace directive detected. Verify dependency source."
    metadata:
      cwe: CWE-829
      owasp: A06:2021-Vulnerable Components


  # =========================================================
  # A07: Identification & Authentication Failures
  # =========================================================
  - id: go-plaintext-password-compare
    severity: HIGH
    languages: [go]
    pattern: if $PWD == $INPUT
    message: "Plaintext password comparison detected."
    metadata:
      cwe: CWE-521
      owasp: A07:2021-Identification and Authentication Failures

  - id: go-jwt-no-validation
    severity: HIGH
    languages: [go]
    pattern: jwt.Parse(...)
    message: "JWT parsed without explicit signature validation."
    metadata:
      cwe: CWE-347
      owasp: A07:2021-Identification and Authentication Failures


  # =========================================================
  # A08: Software and Data Integrity Failures
  # =========================================================
  - id: go-unsafe-gob-deserialization
    severity: CRITICAL
    languages: [go]
    pattern: gob.NewDecoder(...).Decode(...)
    message: "Unsafe deserialization using gob detected."
    metadata:
      cwe: CWE-502
      owasp: A08:2021-Software and Data Integrity Failures


  # =========================================================
  # A09: Logging and Monitoring Failures
  # =========================================================
  - id: go-panic-recover-swallowed
    severity: LOW
    languages: [go]
    pattern: recover()
    message: "recover() used without logging or handling."
    metadata:
      cwe: CWE-391
      owasp: A09:2021-Logging and Monitoring Failures


  # =========================================================
  # A10: Server-Side Request Forgery (SSRF)
  # =========================================================
  - id: go-ssrf
    severity: HIGH
    languages: [go]
    mode: taint
    source:
      - r.URL.Query().Get(...)
      - r.FormValue(...)
    sink:
      - http.Get(...)
      - client.Do(...)
    message: "User input used in outbound HTTP request (possible SSRF)."
    metadata:
      cwe: CWE-918
      owasp: A10:2021-SSRF


  # =========================================================
  # File System & Path Traversal
  # =========================================================
  - id: go-path-traversal
    severity: HIGH
    languages: [go]
    mode: taint
    source:
      - r.URL.Query().Get(...)
    sink:
      - os.Open(...)
      - ioutil.ReadFile(...)
    message: "User input used in file path (path traversal)."
    metadata:
      cwe: CWE-22


  # =========================================================
  # Cross-Site Scripting (HTML Responses)
  # =========================================================
  - id: go-xss
    severity: HIGH
    languages: [go]
    mode: taint
    source:
      - r.URL.Query().Get(...)
    sink:
      - w.Write(...)
      - fmt.Fprint(...)
    message: "Reflected XSS vulnerability detected."
    metadata:
      cwe: CWE-79
